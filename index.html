<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FIGHT CLUB</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
      font-family: Arial, sans-serif;
    }

    /* Intro Screen */
    #intro {
      position: absolute;
      width: 100%;
      height: 100%;
      background: url('https://i.pinimg.com/originals/08/d9/ef/08d9ef7723de602edefa8af825d9a1e2.gif');
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10;
      background-repeat: no-repeat;
      background-size: cover;
    }

    #startBtn {
      margin-top: 20px;
      padding: 15px 40px;
      background: red;
      color: white;
      font-size: 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }

    /* Curtain Animation */
    .curtain {
      position: absolute;
      width: 50%;
      height: 100%;
      top: 0;
      background: #111;
      z-index: 9;
      transition: transform 1s ease;
    }

    #leftCurtain { left: 0; }
    #rightCurtain { right: 0; }

    /* Game Area */
    #gameCanvas {
      display: block;
      margin: auto;
      background: url('https://cdna.artstation.com/p/assets/images/images/012/113/288/large/eric-_j-08213.jpg?1533108263') no-repeat center center;
      background-size: cover;
    }

    .fighter-img {
      width: 350px !important;
      height: 520px !important;
      object-fit: contain;
      transition: box-shadow 0.2s, filter 0.2s;
    }
    /* Bloody flash effect removed */
    .hit-effect {
      animation: hitShake 0.2s;
    }
    @keyframes hitShake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-15px); }
      50% { transform: translateX(15px); }
      75% { transform: translateX(-10px); }
      100% { transform: translateX(0); }
    }
    /* Health bar animation */
    #healthBar {
      opacity: 0;
      transition: opacity 0.8s;
    }
    #healthBar.visible {
      opacity: 1;
    }

    #koImage.flash {
      animation: koFlash 1s;
    }
    @keyframes koFlash {
      0% { opacity: 0; filter: drop-shadow(0 0 40px red);}
      30% { opacity: 1; filter: drop-shadow(0 0 60px red);}
      70% { opacity: 1; filter: drop-shadow(0 0 60px red);}
      100% { opacity: 0.8; filter: drop-shadow(0 0 40px red);}
    }
    @media (max-width: 900px) {
      #gameCanvas {
        width: 100vw !important;
        height: 60vw !important;
        max-width: 100vw;
        max-height: 100vw;
      }
      .fighter-img {
        width: 15vw !important;
        height: 22vw !important;
      }
      #healthBar {
        width: 90vw !important;
      }
      #mobileControls {
        display: flex !important;
      }
    }
    #mobileControls {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: none;
      z-index: 50;
      gap: 10px;
      justify-content: center;
      align-items: center;
    }
    .mc-btn {
      width: 60px;
      height: 60px;
      font-size: 28px;
      border-radius: 50%;
      border: none;
      background: #222;
      color: #fff;
      box-shadow: 0 0 10px #000;
      margin: 0 5px;
      cursor: pointer;
      user-select: none;
      touch-action: manipulation;
    }
  </style>
</head>
<body>

  <!-- Intro Screen -->
  <div id="intro">
    <h1>WELCOME TO FIGHT CLUB</h1>
    <button id="startBtn">Start</button>
  </div>

  <!-- Curtains -->
  <div id="leftCurtain" class="curtain"></div>
  <div id="rightCurtain" class="curtain"></div>

  <!-- Game Canvas -->
  <canvas id="gameCanvas" width="900" height="500"></canvas>
  <img id="spiderman" class="fighter-img" src="Spiderman Gif.gif" style="position:absolute; left:150px; top:180px; display:none; z-index:11; transform: scaleX(1);">
  <img id="venom" class="fighter-img" src="1e6a20e56e7e81ce8ea61f2e750d409b.gif" style="position:absolute; left:650px; top:180px; display:none; z-index:11; transform: scaleX(1);">
  <img id="koImage" src="footagecrate-ko-style1@2X.png" style="position:absolute; left:50%; top:60%; transform:translate(-50%,-50%); width:320px; display:none; z-index:30; transition: top 1s cubic-bezier(.68,-0.55,.27,1.55), opacity 0.5s;">

  <div id="healthBar" style="position:absolute; top:20px; left:50%; transform:translateX(-50%); width:600px; display:flex; justify-content:space-between; z-index:12;">
    <div>
      <span style="color:white;">Spiderman</span>
      <div id="spidermanHealth" style="width:200px; height:20px; background:red; border:2px solid white;"></div>
    </div>
    <div>
      <span style="color:white;">Venom</span>
      <div id="venomHealth" style="width:200px; height:20px; background:red; border:2px solid white;"></div>
    </div>
  </div>
  <div id="result" style="position:absolute; top:50%; left:10%; transform:translateY(-50%); z-index:20; display:none; text-align:left; background:none;">
    <!-- Victory image will be injected here -->
  </div>
  <div id="winnerText" style="position:absolute; top:50%; right:9%; transform:translateY(-50%); color:#fff; font-size:48px; font-weight:bold; text-shadow:2px 2px 8px #000; z-index:21; display:none; text-align:right;">
  </div>
  <button id="restartBtn" style="position:absolute; top:65%; right:9%; transform:translateY(-50%); font-size:32px; padding:18px 50px; background:red; color:white; border:none; border-radius:14px; z-index:22; display:none; cursor:pointer;">
    Restart
  </button>

  <!-- Mobile Controls -->
  <div id="mobileControls">
    <button class="mc-btn" id="btnLeft">&#8592;</button>
    <button class="mc-btn" id="btnRight">&#8594;</button>
    <button class="mc-btn" id="btnJump">&#8679;</button>
    <button class="mc-btn" id="btnAttack">&#9876;</button>
    <button class="mc-btn" id="btnShield">&#128737;</button>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const spiderman = document.getElementById("spiderman");
    const venom = document.getElementById("venom");
    const spidermanHealthBar = document.getElementById("spidermanHealth");
    const venomHealthBar = document.getElementById("venomHealth");
    const resultDiv = document.getElementById("result");
    const koImage = document.getElementById("koImage");
    const healthBar = document.getElementById("healthBar");

    let canAttack = true;
    let canShield = true;
    let isJumping = false;
    let jumpHeight = 120; // Jump height above Venom
    let jumpDuration = 500; // ms

    // Fighter positions (choti height)
    let player1 = { x: 60, y: 120, speed: 5, width: 120, height: 180, health: 100 };
    let player2 = { x: 490, y: 120, speed: 5, width: 120, height: 180, health: 150 }; // Venom ki HP 150

    const keys = {};
    let gameOver = false;
    let shieldActive = false;

    // Shield image add (optional, you can use your own image)
    const shieldImg = document.createElement("img");
    shieldImg.src = "shield.gif";
    shieldImg.style.position = "absolute";
    shieldImg.style.width = "80px";
    shieldImg.style.height = "80px";
    shieldImg.style.left = "0px";
    shieldImg.style.top = "0px";
    shieldImg.style.zIndex = "12";
    shieldImg.style.display = "none";
    document.body.appendChild(shieldImg);

    // Update shield position and direction
    function updateShieldPosition() {
      if (!shieldActive) return;
      // Shield ko Spiderman ke bilkul front per rakhein
      let shieldX, shieldY;
      let offsetY = player1.height / 2 - 40; // vertical center
      if (spiderman.style.transform === "scaleX(-1)") {
        // Spiderman left ki taraf dekh raha hai
        shieldX = player1.x - shieldImg.width + 20; // thoda overlap
      } else {
        // Spiderman right ki taraf dekh raha hai
        shieldX = player1.x + player1.width - 20; // thoda overlap
      }
      shieldY = player1.y + offsetY;
      shieldImg.style.left = shieldX + "px";
      shieldImg.style.top = shieldY + "px";
    }

    // Keydown/keyup for shield, attack, jump
    window.addEventListener("keydown", (e) => {
      keys[e.key] = true;
      // Attack only if not shielding or jumping
      if (e.key === " " && !gameOver && canAttack && !shieldActive && !isJumping) {
        attack(player1, player2, venom, "Venom");
        canAttack = false;
      }
      // Shield only if not attacking or jumping
      if (e.key === "Enter" && !gameOver && !isJumping && !shieldActive) {
        shieldActive = true;
        shieldImg.style.display = "block";
        updateShieldPosition();
        canAttack = false; // Disable attack while shield is active
      }
      // Jump only if not shielding or attacking
      if (e.key === "Shift" && !gameOver && !isJumping && !shieldActive && canAttack) {
        isJumping = true;
        let originalY = player1.y;
        player1.y = originalY - jumpHeight;
        spiderman.style.top = player1.y + "px";
        shieldImg.style.display = "none"; // Hide shield during jump
        setTimeout(() => {
          player1.y = originalY;
          spiderman.style.top = player1.y + "px";
          isJumping = false;
          canAttack = true;
        }, jumpDuration);
      }
    });
    window.addEventListener("keyup", (e) => {
      keys[e.key] = false;
      if (e.key === " ") {
        canAttack = true;
      }
      if (e.key === "Enter") {
        shieldActive = false;
        shieldImg.style.display = "none";
        canAttack = true; // Enable attack after shield is released
      }
    });

    // Venom bot logic
    function venomBot() {
      if (gameOver) return;

      let botSpeed = 10; // Hard level
      let botRange = 40; // Attacks from a bit farther

      // Move towards Spiderman aggressively
      if (player2.x > player1.x) {
        player2.x -= botSpeed;
        venom.style.transform = "scaleX(-1)"; // Venom faces left
      } else if (player2.x < player1.x) {
        player2.x += botSpeed;
        venom.style.transform = "scaleX(1)"; // Venom faces right
      }

      // Stay inside frame
      if (player2.x < 0) player2.x = 0;
      if (player2.x + player2.width > canvas.width) player2.x = canvas.width - player2.width;

      // Attack more frequently and from a bit farther
      if (
        player2.x + player2.width > player1.x - botRange &&
        player2.x < player1.x + player1.width + botRange
      ) {
        venom.style.transform = player2.x < player1.x ? "scaleX(1)" : "scaleX(-1)"; // Face Spiderman before attack
        attack(player2, player1, spiderman, "Spiderman");
      }

      setTimeout(venomBot, 250);
    }

    // GIF file names (replace with your actual file names)
    const spidermanIdle = "Spiderman Gif.gif";
    const spidermanAttack = "spiderattacking.gif";
    const spidermanWin = "spiderbeatingvenom.gif";
    const venomIdle = "1e6a20e56e7e81ce8ea61f2e750d409b.gif";
    const venomAttack = "venomattacking.gif";
    const venomWin = "venomwin.gif";

    // GIF size function (choti height)
    function setFighterSize(img, size = "idle", playerObj = null) {
      // Remove !important from JS, override with inline style
      if (size === "attack") {
        img.style.width = "400px";
        img.style.height = "520px";
        if (playerObj) {
          playerObj.width = 400;
          playerObj.height = 520;
        }
      } else if (size === "win") {
        img.style.width = "120px";
        img.style.height = "180px";
        if (playerObj) {
          playerObj.width = 120;
          playerObj.height = 180;
        }
      } else { // idle
        img.style.width = "100px";
        img.style.height = "150px";
        if (playerObj) {
          playerObj.width = 100;
          playerObj.height = 150;
        }
      }
    }

    function showKO() {
      koImage.style.display = "block";
      koImage.classList.add("flash");
      koImage.style.top = "60%";
      koImage.style.opacity = "1";
      setTimeout(() => {
        koImage.classList.remove("flash");
        // Health bar center calculation
        const healthBarRect = healthBar.getBoundingClientRect();
        const koHeight = koImage.offsetHeight;
        const canvasRect = canvas.getBoundingClientRect();
        const healthBarCenterY = healthBarRect.top + healthBarRect.height / 2 - canvasRect.top;
        koImage.style.top = healthBarCenterY + "px";
        koImage.style.opacity = "1";
        // KO image disappears after 2 seconds
        setTimeout(() => {
          koImage.style.display = "none";
        }, 1000);
      }, 1000); // 1s flash + 1s center = 2s total
    }

    function showVictory(winner) {
      // Remove previous content
      resultDiv.innerHTML = "";
      document.getElementById("winnerText").innerHTML = "";
      let victoryImg = document.createElement("img");
      victoryImg.style.width = "500px";
      victoryImg.style.height = "420px";
      victoryImg.style.objectFit = "contain";
      victoryImg.style.display = "block";
      victoryImg.style.marginBottom = "-20px";
      victoryImg.style.borderRadius = "20px";
      victoryImg.style.boxShadow = "none"; // Yellow border removed

      if (winner === "spiderman") {
        victoryImg.src = spidermanWin;
        resultDiv.appendChild(victoryImg);
        document.getElementById("winnerText").innerText = "Spiderman Wins!";
      } else {
        victoryImg.src = venomWin;
        resultDiv.appendChild(victoryImg);
        document.getElementById("winnerText").innerText = "Venom Wins!";
      }
      resultDiv.style.display = "block";
      document.getElementById("winnerText").style.display = "block";
      document.getElementById("restartBtn").style.display = "block";
    }

    function attack(attacker, defender, defenderImg, defenderName) {
      const range = 20;
      if (attacker === player2 && (shieldActive || isJumping)) {
        return;
      }

      if (attacker === player1) {
        spiderman.src = spidermanAttack;
        setFighterSize(spiderman, "attack", player1);
        setTimeout(() => {
          if (!gameOver) {
            spiderman.src = spidermanIdle;
            setFighterSize(spiderman, "idle", player1);
          }
        }, 400);
      } else {
        venom.src = venomAttack;
        setFighterSize(venom, "attack", player2);
        setTimeout(() => {
          if (!gameOver) {
            venom.src = venomIdle;
            setFighterSize(venom, "idle", player2);
          }
        }, 400);
      }

      if (
        attacker.x + attacker.width > defender.x - range &&
        attacker.x < defender.x + defender.width + range
      ) {
        defender.health -= 10;
        if (defender.health < 0) defender.health = 0;
        updateHealthBars();

        defenderImg.classList.add("hit-effect");
        setTimeout(() => defenderImg.classList.remove("hit-effect"), 200);

        if (defender.health === 0) {
          gameOver = true;
          showKO();

          // Hide both character images
          spiderman.style.display = "none";
          venom.style.display = "none";

          // Show only victory image on left and winner text on right
          if (attacker === player1) {
            showVictory("spiderman");
          } else {
            showVictory("venom");
          }
        }
      }
    }

    function updateHealthBars() {
      // Bar size fix (200px) for both, HP text show above
      spidermanHealthBar.style.width = "200px";
      venomHealthBar.style.width = "200px";
      spidermanHealthBar.innerText = player1.health + " HP";
      venomHealthBar.innerText = player2.health + " HP";
      if (player1.health <= 30) spidermanHealthBar.style.background = "orange";
      else spidermanHealthBar.style.background = "red";
      if (player2.health <= 30) venomHealthBar.style.background = "orange";
      else venomHealthBar.style.background = "red";
    }

    // Update shield position in gameLoop
    function gameLoop() {
      if (gameOver) return;

      // Move Player 1 (WASD) -- Only if not jumping
      if (!isJumping) {
        if (keys["a"] && player1.x > 0) {
          player1.x -= player1.speed;
          if (player1.x < 0) player1.x = 0;
          spiderman.style.transform = "scaleX(-1)";
        }
        if (keys["d"] && player1.x + player1.width < canvas.width) {
          player1.x += player1.speed;
          if (player1.x + player1.width > canvas.width) player1.x = canvas.width - player1.width;
          spiderman.style.transform = "scaleX(1)";
        }
        player1.y = 120; // Only set y if not jumping
      }
      player2.y = 120;

      // Update GIF positions
      spiderman.style.left = player1.x + "px";
      spiderman.style.top = player1.y + "px";
      venom.style.left = player2.x + "px";
      venom.style.top = player2.y + "px";

      // Shield position update
      updateShieldPosition();

      requestAnimationFrame(gameLoop);
    }

    // Start Button Event
    document.getElementById("startBtn").addEventListener("click", () => {
      document.getElementById("intro").style.display = "none";
      document.getElementById("leftCurtain").style.transform = "translateX(-100%)";
      document.getElementById("rightCurtain").style.transform = "translateX(100%)";
      // Health bar animation
      setTimeout(() => {
        document.getElementById("healthBar").classList.add("visible");
        spiderman.style.display = "block";
        venom.style.display = "block";
        updateHealthBars();
        gameLoop();
        venomBot(); // Start Venom bot
      }, 1000);
    });

    document.getElementById("restartBtn").addEventListener("click", () => {
      // Reset health
      player1.health = 100;
      player2.health = 150; // Venom ki HP reset
      updateHealthBars();

      // Reset positions (frame ke andar)
      player1.x = 60; player1.y = 120;
      player2.x = 490; player2.y = 120;

      // Reset images
      spiderman.src = spidermanIdle;
      venom.src = venomIdle;
      setFighterSize(spiderman, "normal", player1);
      setFighterSize(venom, "normal", player2);

      // Show both fighters
      spiderman.style.display = "block";
      venom.style.display = "block";

      // Hide result, restart button, KO image
      resultDiv.style.display = "none";
      document.getElementById("winnerText").style.display = "none";
      document.getElementById("restartBtn").style.display = "none";
      koImage.style.display = "none";

      // Reset game state
      gameOver = false;
      canAttack = true; // Reset attack lock
      gameLoop();
      venomBot(); // <-- Restart bot
    });

    // On load, health bar hidden
    document.getElementById("healthBar").classList.remove("visible");

    // Force landscape on mobile
    function forceLandscape() {
      if (window.innerHeight > window.innerWidth) {
        document.body.innerHTML = '<div style="color:white; background:black; height:100vh; display:flex; align-items:center; justify-content:center; font-size:2em;">Please rotate your device to landscape mode to play.</div>';
      }
    }
    window.addEventListener('resize', forceLandscape);
    window.addEventListener('orientationchange', forceLandscape);
    forceLandscape();

    // Show mobile controls if on mobile
    function isMobile() {
      return /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(navigator.userAgent);
    }
    if (isMobile()) {
      document.getElementById("mobileControls").style.display = "flex";
    }

    // Mobile controls logic
    document.getElementById("btnLeft").addEventListener("touchstart", () => { keys["a"] = true; });
    document.getElementById("btnLeft").addEventListener("touchend", () => { keys["a"] = false; });
    document.getElementById("btnRight").addEventListener("touchstart", () => { keys["d"] = true; });
    document.getElementById("btnRight").addEventListener("touchend", () => { keys["d"] = false; });
    document.getElementById("btnJump").addEventListener("touchstart", () => {
      if (!gameOver && !isJumping && !shieldActive && canAttack) {
        isJumping = true;
        let originalY = player1.y;
        player1.y = originalY - jumpHeight;
        spiderman.style.top = player1.y + "px";
        shieldImg.style.display = "none";
        setTimeout(() => {
          player1.y = originalY;
          spiderman.style.top = player1.y + "px";
          isJumping = false;
          canAttack = true;
        }, jumpDuration);
      }
    });
    document.getElementById("btnAttack").addEventListener("touchstart", () => {
      if (!gameOver && canAttack && !shieldActive && !isJumping) {
        attack(player1, player2, venom, "Venom");
        canAttack = false;
      }
    });
    document.getElementById("btnAttack").addEventListener("touchend", () => { canAttack = true; });
    document.getElementById("btnShield").addEventListener("touchstart", () => {
      if (!gameOver && !isJumping && !shieldActive) {
        shieldActive = true;
        shieldImg.style.display = "block";
        updateShieldPosition();
        canAttack = false;
      }
    });
    document.getElementById("btnShield").addEventListener("touchend", () => {
      shieldActive = false;
      shieldImg.style.display = "none";
      canAttack = true;
    });
  </script>
</body>
</html>
